âŸ¨
  Min1
âŸ©â‡

_while_ â† {ğ”½âŸğ”¾âˆ˜ğ”½_ğ•£_ğ”¾âˆ˜ğ”½âŸğ”¾ğ•©}

# 1-dimensional minimization, beginning at interval Â¯1â€¿1
# Return âŸ¨argument, valueâŸ© for a local minimum
Min1 â† { tol ğ•Š f:
  phi â† 2Ã·Ëœ1+âˆš5  # golden ratio
  phi2 â† 2 - phi
  max_iter â† 100

  # Find initial minimum range, with steps increasing by factors of phi
  Init â† âˆ¾{
    v â† (âŠ¢ + phi Ã— -Ëœ)Â´ Â¯2â†‘ğ•¨
    (vğ”½ğ•¨) (<Â´1â†“âŠ¢)â—¶âŸ¨Â«_ğ•£,â‰Ë˜âŸ© (F v)ğ”½ğ•©
  }
  val â† âˆ§ {ğ•¨ Initâ—‹((â’ğ•©)âŠ¸âŠ) ğ•©}âŸœF Â¯1â€¿1

  # Decrease bounding interval to tolerance
  eâ†dâ†0                      # Distance on two previous steps
  bounds â† âŠË˜ 0â€¿Â¯1âŠval       # Possible range
  mins â† 3âŠ¸â¥ŠÂ¨ 1âŠval          # Lowest 3 values; initially same

  iter â† 0
  âŠ¢_while_ {ğ•¤
    # Conditions
    max_iter > iter+â†©1 ?
    Â¯âˆ < âŠ‘1âŠ‘mins ?
    bx â† bounds - âŠ‘âŠ‘mins
    (2Ã—tol) < -âŠ¸âŒˆÂ´bx ?

    # Compute sign s, distance d, saved distance e
    sâ†@ â‹„ sâ€¿dâ€¿e â†© {
      tol<e? 2<iter?
      # Parabolic interpolation
      rq â† (âŠ‘ - 1âŠ¸â†“)Â¨ mins
      a â† | dn â† (Ã—ËœâŠ¸Ã— 0âŠ¸â‰ â—¶âˆâ€¿Ã·âŸœ(Â¯2âŠ¸Ã—)â—‹(-Â´) Ã—)âŸœâŒ½Â´ rq
      =Ëœdn ?              # Not NaN
      e > 2Ã—a ?           # Movement needs to decrease enough
      tol < -âŠ¸âŒŠÂ´ bx-dn ?  # Stay away from bounds
      âŸ¨Ã—dn,a,dâŸ©
    ;
      # Non-interpolation method: golden split of smaller half
      a â† | b â† -âŠ¸<Â´âŠ¸âŠ‘ bx
      âŸ¨Ã—b,phi2Ã—a,aâŸ©
    }

    x â† âŠ‘âŠ‘mins
    uf â† F u â† x + sÃ—tolâŒˆd               # Move at least tol from x

    i â† 0 < p â† âŠ‘ (1âŠ‘mins) â‹ uf          # Position of u
    bounds â†© (iâŠ‘xâ€¿u)Ë™âŒ¾((i=0<s)âŠ¸âŠ‘) bounds # Tighten bounds; always drop one
    mins {p (â†‘âˆ¾ğ•©Â»â†“) ğ•¨}Â¨â†© uâ€¿uf            # Three lowest points; might discard u and keep all
    1;0
  }@

  âŠ‘Â¨ mins
}

# linear minimizer in multidimensions
# y is (initial value â‰ direction vector);(tolerance)
# returns (lowest point);(function value)
_linmin â† { ğ”½_ğ•£ ptsâ€¿tol:
  startâ€¿dir â† <Ë˜pts
  Trans â† start + dirâŠ¸Ã—
  Fn â† ğ”½âˆ˜Transâš‡0
  TransâŒ¾âŠ‘ tol Min1 fn
}
