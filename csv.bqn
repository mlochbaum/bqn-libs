# Comma-separated values (.csv)
âŸ¨
  Split , Join   # Convert between plain text and split cells
  SplitL, JoinL  # Between list of lines and split cells
âŸ©â‡

# Control characters: double quote, comma, newline
control â† {
  0=â‰ â€¢args ? ""","âˆ¾@+10 ;
  ("CSV: â€¢args must consist of 3 values" ! âŸ¨3âŸ©â‰¡â‰¢)âŠ¸âŠ¢ âˆ¾âŸ(1<â‰¡) â€¢args
}

# Join by separator ğ•¨
J â† âˆ¾1â†“Â·â¥Š<âŠ¸(â‰Ë˜)

# CSV text to list of list of strings
Split â† { ğ•Šâ¼ğ•©: Joinğ•© ;
  [q,c,n] â† control=âŒœğ•©
  e â† â‰ `q       # Escaped characters
  s â† e<câˆ¨n     # Split points
  d â† sâˆ¨q>Â»e<q  # Characters to be dropped
  (0âˆ¾s/+`e<n) âŠ” (d(Â¬âŠ¸Ã—-âŠ£)+`s) âŠ” ğ•©
}

# Parse list of lines, e.g. from â€¢file.Lines
SplitL â† { ğ•Šâ¼ğ•©: JoinLğ•© ; Split (2âŠ‘control) J ğ•© }

# List of list of strings, or table, to list of lines
# Result contains internal line separators if ğ•© does
JoinL â† { ğ•Šâ¼ğ•©: SplitLğ•© ;
  qâ€¿câ€¿n â† control
  ğ•© <Ë˜âŸ(1<=)â†©
  Esc â† (qâˆ¾Ëœqâˆ¾(1+qâŠ¸=)âŠ¸/)âŸ(âˆ¨Â´controlâŠ¸âˆŠ)
  (c J EscÂ¨)Â¨ ğ•©
}

# To CSV text
Join â† { ğ•Šâ¼ğ•©: Splitğ•© ; (2âŠ‘control) J JoinL ğ•© }
