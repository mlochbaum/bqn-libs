# Arithmetic on large natural numbers.

base â† âŠ‘ â€¢args âˆ¾ 2â‹†24  # Less than half 2â‹†53

_while_ â† {ğ”½âŸğ”¾âˆ˜ğ”½_ğ•£_ğ”¾âˆ˜ğ”½âŸğ”¾ğ•©}

_extend â† { ğ•¨ ğ”½â—‹((ğ•¨âŒˆâ—‹â‰ ğ•©)âŠ¸â†‘) ğ•© }

Trim â† { ğ•© â†‘Ëœ -âŸœ1 _while_ (â‰¥â—¶âŸ¨0,0=-âŠ‘ğ•©Ë™âŸ©âŸœ1) â‰ ğ•© }

Carry1 â† {
  g â† ğ•© â‰¥ base        # Generate
  p â† ğ•© = base-1      # Propagate
  i â† âŒˆ`âˆ˜Ã—âŸœ(1+â†•âˆ˜â‰ )Â¬p  # Start index of propagation chain
  a â† i âŠ gsâ†0âˆ¾g      # Active propagations
  c â† g âˆ¨ p âˆ§ a       # Carry from these positions
  r â† (ğ•© + Â»c) - cÃ—base
  âŸ¨r, âŠ¢Â´gsâŸ©
}
Carry â† {
  âˆ§Â´ (0â‰¤ğ•©) âˆ§ (base+base-1)>ğ•© ? Carry1 ğ•© ;
  c â† âŒŠğ•©Ã·base
  (âŠ‘Â¯1â†‘c)âŠ¸+âŒ¾(1âŠ¸âŠ‘) ğ•Š (Â»c) + ğ•©-baseÃ—c
}

Add â‡ {
  0âŠ¸<â—¶âŠ£â€¿âˆ¾Â´ Carry1 ğ•¨ +_extend ğ•©
}

Sub â‡ {
  ! ğ•¨ â‰¥â—‹â‰  ğ•©
  sâ€¿c â† Carry ğ•¨ -_extend ğ•©
  ! 0 = c
  Trim s
}

Mul â‡ {
  32 < nâ†ğ•¨âŒŠâ—‹â‰ ğ•© ? # Karatsuba
    kâ†âŒŠnÃ·2
    # AddâŸœ((kâ¥Š0)âŠ¸âˆ¾){ğ”½Â´ğ”½Â¨Ë} ğ•¨ ğ•ŠâŒœâ—‹(kâŠ¸(â†‘â‹ˆâ†“)) ğ•©  but one less ğ•Š
    lâ€¿hâ€¿a â† ğ•¨ ğ•ŠÂ¨â—‹(âˆ¾âŸœ(<AddÂ´)kâŠ¸(â†‘â‹ˆâ†“)) ğ•©
    AddâŸœ((kâ¥Š0)âŠ¸âˆ¾)Â´ âŸ¨l, a Sub l Add h, hâŸ©
  ;
  # Requires ((Ã—Ëœbase)Ã—ğ•¨âŒŠâ—‹â‰ ğ•©) â‰¤ 2â‹†53; guaranteed by check above
  0âŠ¸<â—¶âŸ¨TrimâŠ£,âˆ¾âŸ©Â´ Carry (â‰ âŠ¸â†‘Ëœ+âŠ¢)âŸœ(0âŠ¸âˆ¾)Ë ğ•¨ Ã—âŒœ ğ•©
}

_compare â‡ {
  Full â† 0âŠ¸â‰¤â—¶âŸ¨ğ”½Ëœ,âŠ‘âŸœğ•¨ğ”½âŠ‘âŸœğ•©âŸ© Â· -âŸœ1 _while_ (0âŠ¸â‰¤â—¶âŸ¨0,âŠ‘âŸœğ•¨=âŠ‘âŸœğ•©âŸ©) -âŸœ1
  ğ•¨ =â—¶ğ”½â€¿Fullâ—‹â‰  ğ•©
}

Neg â‡ (!0=â‰ )âŠ¸âŠ¢
Signum â‡ Ã—âˆ˜â‰ 
Abs â‡ Conj â‡ âŠ¢
