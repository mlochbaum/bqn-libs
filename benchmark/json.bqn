âŸ¨_lineâŸ© â† â€¢Import "util.bqn"
âŸ¨ParseâŸ© â† â€¢Import "../json.bqn"

L â† 36 _line âŸœ ((1e6Ã·â‰ ) Ã— 1e3 Parseâ€¢_timed âŠ¢)
LVâ† LâŸœ(Parseâ¼)
R â† â€¢rand.Range

Q â† '"'âŠ¸(âˆ¾âˆ¾âŠ£)
Esc â† { mâ€¿k ğ•Š ğ•©: # Add m basic and k compound (\u) escapes to ğ•©
  Sub â† â€¢rand.Subset
  t â† m+k
  u â† t â†‘ /â¼ k Sub t     # Which are compound
  l â† 2â€¿6 â‹„ a â† +`uâŠl-1  # Total added characters after each escape
  iâ€¿j â† l +âŒœâŸœâ†•ËœÂ¨ (uâˆ¾2) âŠ” (Â»a) + t Sub (â‰ ğ•©)-âŠ¢Â´a
  ei â† (m R â‰ )âŠ¸âŠ '\'â‰Ë˜"""\/bfrnt"
  ej â† "\u"âŠ¸âˆ¾Ë˜ (âˆ¾"0A"+âŸœâ†•Â¨10â€¿6) âŠËœ 13âŠ¸=âŠ¸+âŒ¾(âŠË˜) kâ€¿4 R 16 # Avoid surrogates 13â€¦
  ejâŒ¾(jâŠ¸âŠ)âŸ(0<k) eiâŒ¾(iâŠ¸âŠ) ğ•©
}
s4 â† '#'+(1e4-2)R-Â´"\#"  # Non-escape characters

â€¢Out "Times normalized to s/MB!"

â€¢Out "Long string, no escapes"            L  Q s4
â€¢Out "Long string, 20% basic escapes"     L  Q 1e3â€¿0 Esc s4
â€¢Out "Long string, 10% basic / 15% \u"    L  Q 500â€¿250 Esc s4
â€¢Out "Long string, all \u escapes"        L  Q 0â€¿1e3 Esc 6e3â¥Š' '
â€¢Out "Strings with ~10 characters"        LV âŠ”âŸœ('#'âŠ¸+)Â´1e3 RÂ¨ 1e2â‹ˆ-Â´"\#"
â€¢Out "Natural numbers <1e4"               LV 1e3 R 1e4
â€¢Out "Natural numbers <1e4, lists of ~10" LV âŠ”Â´1e3 RÂ¨ 1e2â€¿1e4
â€¢Out "1e3 nested []"                      L  1e3/"[]"
â€¢Out "1e3 paired []"                      LV 1e3â¥Š<âŸ¨âŸ©
â€¢Out "1e3 paired {}"                      LV 1e3â¥Š<2â€¿0â¥Š0
