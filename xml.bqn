# XML: Extensible Markup Language
âŸ¨
  Parse   # XML string to BQN
âŸ©â‡

# Represent text as a string
# Non-void tags are a list of:
# - Tag name
# - Attributes, as namesâ‰values
# - Contents: list of text and tags
E â† +`âŠ¸Ã—âŸœÂ¬-âŠ¢
Parse â† {
  # Resolve special tags
  [sm,sn] â† (â‰ âˆ˜âŠ¢â†‘â·)âŸœğ•©Â¨["<!--"â€¿"<![CDATA[","-->"â€¿"]]>"]
  ssâ†âˆ¾/Â¨sm â‹„ sfâ†âˆ¾sm(0âˆ¾+`)âŠ¸(-âŸœÂ»âˆ˜âŠËœ/âŠ¢)âŸœ(/âˆ¾âŸœ1)Â¨sn
  Seâ†â‰ (>/âŠ¢)âˆ¾âŸœâ‰ {(âŠËœğ•¨)ğ•ŠâŸ(â‰ â—‹(Â¯1âŠ¸âŠ‘))ğ•©âˆ¾ğ•©âŠğ•¨}âŸ¨0âŸ©Ë™
  exclâ†â‰ `âŠ¸>(â‰ ğ•©)â†‘/â¼â¥Šss(Seâˆ˜â‹âŠâ‰Ë˜)â—‹((â‹ss)âŠ¸âŠ)sf
  # Extract tags
  obj â† ((+âŸœÂ»Eâˆ¨)ËexclâŠ¸<Ë˜"<>"=âŒœğ•©)âŠ”ğ•©
  tag â† (â†•2)â¥ŠËœâ‰ obj
  tagâ€¿obj (tagâˆ¨0<â‰ Â¨obj)âŠ¸/Â¨â†©
  GTâ† (âˆ§Â´"!?"â‰ âŠ‘)Ã—1-Â·+ËœâŠ¸+Â´'/'=0â€¿Â¯1âŠ¸âŠ
  d â† +`ttâ†obj GTâˆ˜âŠ£Â¨âŒ¾(tagâŠ¸/) tag     # Tag type: Â¯1 close, 0 void, 1 open
  tpâ† (â‹âŠâŸœd)âŠ¸âŠâˆ˜/Ë˜ 1â€¿Â¯1=âŒœtt           # Tag pairs
  ! (âˆ§`' 'âŠ¸â‰ )âŠ¸/Â¨âŠ¸â‰¡âŸœ(1âŠ¸â†“Â¨)ËtpâŠobj     # Tag matching
  oâ†tt>0 â‹„ câ†tt<0
  opâ† ParseAttrÂ¨ o/obj
  l â† +`âŒ¾((â‹d)âŠ¸âŠ) 0<tt               # Parent index
  nvâ† â‰ vals â† (tt=0)/obj             # Initial set of values
  f â† ttâ‰¤0                           # Reduce open/closed pairs to end
  viâ† â‹â‹f/c                          # Value indices
  i â† vi âŠ (â†•nv) âˆ¾ nv+â‰ âŠ¸-c/Â»l        # Adjust for collection ordering
  (âŸ¨âŸ©â‹ˆâŠ¸âˆ¾op) {valsâˆ¾â†©âŸ¨ğ•¨âˆ¾âŸ¨ğ•©âŠvalsâŸ©âŸ©â‹„@}Â¨â—‹âŒ½ ((1+Â´c)âˆ¾Ëœf/l)âŠ”i
  âŠ‘Â¯1âŠ‘vals
}
ParseAttr â† {
  nameâ€¿a â† (âŠ‘â‹ˆ1âŠ¸â†“) (EËœ' 'âŠ¸=>Â·â‰ `'"'âŠ¸=)âŠ¸âŠ”ğ•©
  âŸ¨name, â‰>(EËÂ·âˆ¨`"="""=âŒœâŠ¢)âŠ¸âŠ”Â¨aâŸ©
}
